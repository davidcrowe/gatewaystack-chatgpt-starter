<svg viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-dashed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    MCP Tool Server OAuth Flow
  </text>
  
  <!-- Actors -->
  <g id="user">
    <rect x="50" y="60" width="100" height="40" fill="#4A90E2" stroke="#2E5C8A" stroke-width="2" rx="5"/>
    <text x="100" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">User</text>
    <line x1="100" y1="100" x2="100" y2="750" stroke="#4A90E2" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="chatgpt">
    <rect x="250" y="60" width="100" height="40" fill="#10A37F" stroke="#0D8A6A" stroke-width="2" rx="5"/>
    <text x="300" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">ChatGPT</text>
    <line x1="300" y1="100" x2="300" y2="750" stroke="#10A37F" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="gateway">
    <rect x="450" y="60" width="120" height="40" fill="#E94B3C" stroke="#C93B2C" stroke-width="2" rx="5"/>
    <text x="510" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">MCP Gateway</text>
    <line x1="510" y1="100" x2="510" y2="750" stroke="#E94B3C" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="auth">
    <rect x="650" y="60" width="120" height="40" fill="#9B59B6" stroke="#7D3C98" stroke-width="2" rx="5"/>
    <text x="710" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">OAuth Provider</text>
    <line x1="710" y1="100" x2="710" y2="750" stroke="#9B59B6" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="backend">
    <rect x="850" y="60" width="100" height="40" fill="#F39C12" stroke="#D68910" stroke-width="2" rx="5"/>
    <text x="900" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Backend</text>
    <line x1="900" y1="100" x2="900" y2="750" stroke="#F39C12" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <!-- Flow Steps -->
  <g id="step1">
    <line x1="100" y1="140" x2="290" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="195" y="135" font-size="12" text-anchor="middle" fill="#333">1. User asks ChatGPT</text>
    <text x="195" y="150" font-size="11" text-anchor="middle" fill="#666">to use a tool</text>
  </g>
  
  <g id="step2">
    <line x1="300" y1="180" x2="500" y2="180" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="400" y="175" font-size="12" text-anchor="middle" fill="#333">2. tools/list (no token)</text>
  </g>
  
  <g id="step3">
    <line x1="500" y1="220" x2="310" y2="220" stroke="#E94B3C" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="405" y="215" font-size="12" text-anchor="middle" fill="#E94B3C">3. 401 + WWW-Authenticate</text>
    <text x="405" y="230" font-size="11" text-anchor="middle" fill="#999">(OAuth discovery info)</text>
  </g>
  
  <g id="step4">
    <line x1="300" y1="270" x2="700" y2="270" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="500" y="265" font-size="12" text-anchor="middle" fill="#333">4. Redirect to OAuth login</text>
  </g>
  
  <g id="step5">
    <line x1="710" y1="310" x2="110" y2="310" stroke="#9B59B6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="410" y="305" font-size="12" text-anchor="middle" fill="#9B59B6">5. User authenticates</text>
  </g>
  
  <g id="step6">
    <line x1="100" y1="350" x2="700" y2="350" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="400" y="345" font-size="12" text-anchor="middle" fill="#333">6. Consent & authorize</text>
  </g>
  
  <g id="step7">
    <line x1="710" y1="390" x2="310" y2="390" stroke="#9B59B6" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="510" y="385" font-size="12" text-anchor="middle" fill="#9B59B6">7. OAuth token returned</text>
    <text x="510" y="400" font-size="11" text-anchor="middle" fill="#999">(JWT with scopes)</text>
  </g>
  
  <g id="step8">
    <line x1="300" y1="440" x2="500" y2="440" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="400" y="435" font-size="12" text-anchor="middle" fill="#333">8. tools/list</text>
    <text x="400" y="450" font-size="11" text-anchor="middle" fill="#666">Authorization: Bearer {token}</text>
  </g>
  
  <g id="step9">
    <rect x="480" y="470" width="60" height="30" fill="#FFF3CD" stroke="#FFC107" stroke-width="1" rx="3"/>
    <text x="510" y="490" font-size="11" text-anchor="middle" fill="#856404">Verify JWT</text>
  </g>
  
  <g id="step10">
    <line x1="500" y1="520" x2="310" y2="520" stroke="#10A37F" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="405" y="515" font-size="12" text-anchor="middle" fill="#10A37F">9. Available tools</text>
    <text x="405" y="530" font-size="11" text-anchor="middle" fill="#999">(filtered by scopes)</text>
  </g>
  
  <g id="step11">
    <line x1="300" y1="570" x2="500" y2="570" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="400" y="565" font-size="12" text-anchor="middle" fill="#333">10. tools/call</text>
    <text x="400" y="580" font-size="11" text-anchor="middle" fill="#666">Authorization: Bearer {token}</text>
  </g>
  
  <g id="step12">
    <rect x="480" y="600" width="60" height="30" fill="#FFF3CD" stroke="#FFC107" stroke-width="1" rx="3"/>
    <text x="510" y="615" font-size="11" text-anchor="middle" fill="#856404">Verify JWT</text>
    <text x="510" y="625" font-size="10" text-anchor="middle" fill="#856404">Check scopes</text>
  </g>
  
  <g id="step13">
    <line x1="510" y1="650" x2="890" y2="650" stroke="#666" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-dashed)"/>
    <text x="700" y="645" font-size="12" text-anchor="middle" fill="#666">11. Forward token</text>
    <text x="700" y="660" font-size="11" text-anchor="middle" fill="#999">(optional)</text>
  </g>
  
  <g id="step14">
    <line x1="890" y1="690" x2="520" y2="690" stroke="#F39C12" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-dashed)"/>
    <text x="705" y="685" font-size="12" text-anchor="middle" fill="#F39C12">12. User data</text>
  </g>
  
  <g id="step15">
    <line x1="500" y1="730" x2="310" y2="730" stroke="#10A37F" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="405" y="725" font-size="12" text-anchor="middle" fill="#10A37F">13. Tool result</text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="770" width="900" height="25" fill="#F8F9FA" stroke="#DEE2E6" stroke-width="1" rx="3"/>
    <text x="60" y="787" font-size="11" fill="#495057">
      <tspan font-weight="bold">Key:</tspan>
      <tspan x="110">Solid lines = Required flow</tspan>
      <tspan x="280">Dashed lines = Optional backend integration</tspan>
      <tspan x="560">Yellow boxes = JWT verification points</tspan>
    </text>
  </g>
</svg>