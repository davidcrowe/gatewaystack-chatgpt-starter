<svg viewBox="0 0 1000 820" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="500" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    MCP Tool Server OAuth Flow
  </text>
  
  <!-- Actors -->
  <g id="user">
    <rect x="50" y="60" width="100" height="40" fill="#4A90E2" stroke="#2E5C8A" stroke-width="2" rx="5"/>
    <text x="100" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">User</text>
    <line x1="100" y1="100" x2="100" y2="760" stroke="#4A90E2" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="chatgpt">
    <rect x="250" y="60" width="100" height="40" fill="#10A37F" stroke="#0D8A6A" stroke-width="2" rx="5"/>
    <text x="300" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">ChatGPT</text>
    <line x1="300" y1="100" x2="300" y2="760" stroke="#10A37F" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="gateway">
    <rect x="450" y="60" width="120" height="40" fill="#E94B3C" stroke="#C93B2C" stroke-width="2" rx="5"/>
    <text x="510" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">MCP Gateway</text>
    <line x1="510" y1="100" x2="510" y2="760" stroke="#E94B3C" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="auth">
    <rect x="650" y="60" width="120" height="40" fill="#9B59B6" stroke="#7D3C98" stroke-width="2" rx="5"/>
    <text x="710" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">OAuth Provider</text>
    <line x1="710" y1="100" x2="710" y2="760" stroke="#9B59B6" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <g id="backend">
    <rect x="850" y="60" width="100" height="40" fill="#F39C12" stroke="#D68910" stroke-width="2" rx="5"/>
    <text x="900" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Backend</text>
    <line x1="900" y1="100" x2="900" y2="760" stroke="#F39C12" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <!-- Flow Steps with simple arrows -->
  <g id="step1">
    <line x1="100" y1="140" x2="285" y2="140" stroke="#333" stroke-width="2"/>
    <polygon points="285,140 275,135 275,145" fill="#333"/>
    <text x="195" y="130" font-size="12" text-anchor="middle" fill="#333">1. User asks ChatGPT to use a tool</text>
  </g>
  
  <g id="step2">
    <line x1="300" y1="175" x2="495" y2="175" stroke="#333" stroke-width="2"/>
    <polygon points="495,175 485,170 485,180" fill="#333"/>
    <text x="400" y="165" font-size="12" text-anchor="middle" fill="#333">2. POST /mcp tools/list (no token)</text>
  </g>
  
  <g id="step3">
    <line x1="495" y1="215" x2="315" y2="215" stroke="#E94B3C" stroke-width="2"/>
    <polygon points="315,215 325,210 325,220" fill="#E94B3C"/>
    <text x="405" y="205" font-size="12" text-anchor="middle" fill="#E94B3C">3. 401 + WWW-Authenticate</text>
    <text x="405" y="220" font-size="10" text-anchor="middle" fill="#999">(OAuth discovery info)</text>
  </g>
  
  <g id="step4">
    <line x1="300" y1="260" x2="695" y2="260" stroke="#333" stroke-width="2"/>
    <polygon points="695,260 685,255 685,265" fill="#333"/>
    <text x="500" y="250" font-size="12" text-anchor="middle" fill="#333">4. Redirect to OAuth login</text>
  </g>
  
  <g id="step5">
    <line x1="695" y1="300" x2="115" y2="300" stroke="#9B59B6" stroke-width="2"/>
    <polygon points="115,300 125,295 125,305" fill="#9B59B6"/>
    <text x="410" y="290" font-size="12" text-anchor="middle" fill="#9B59B6">5. User authenticates</text>
  </g>
  
  <g id="step6">
    <line x1="100" y1="340" x2="695" y2="340" stroke="#333" stroke-width="2"/>
    <polygon points="695,340 685,335 685,345" fill="#333"/>
    <text x="400" y="330" font-size="12" text-anchor="middle" fill="#333">6. Consent &amp; authorize</text>
  </g>
  
  <g id="step7">
    <line x1="695" y1="380" x2="315" y2="380" stroke="#9B59B6" stroke-width="2"/>
    <polygon points="315,380 325,375 325,385" fill="#9B59B6"/>
    <text x="510" y="370" font-size="12" text-anchor="middle" fill="#9B59B6">7. OAuth token returned (JWT with scopes)</text>
  </g>
  
  <g id="step8">
    <line x1="300" y1="425" x2="495" y2="425" stroke="#333" stroke-width="2"/>
    <polygon points="495,425 485,420 485,430" fill="#333"/>
    <text x="400" y="415" font-size="12" text-anchor="middle" fill="#333">8. POST /mcp tools/list</text>
    <text x="400" y="430" font-size="10" text-anchor="middle" fill="#666">Authorization: Bearer {token}</text>
  </g>
  
  <g id="step9">
    <rect x="480" y="455" width="60" height="35" fill="#FFF3CD" stroke="#FFC107" stroke-width="1.5" rx="3"/>
    <text x="510" y="475" font-size="11" font-weight="bold" text-anchor="middle" fill="#856404">Verify JWT</text>
  </g>
  
  <g id="step10">
    <line x1="495" y1="510" x2="315" y2="510" stroke="#10A37F" stroke-width="2"/>
    <polygon points="315,510 325,505 325,515" fill="#10A37F"/>
    <text x="405" y="500" font-size="12" text-anchor="middle" fill="#10A37F">9. Available tools (filtered by scopes)</text>
  </g>
  
  <g id="step11">
    <line x1="300" y1="555" x2="495" y2="555" stroke="#333" stroke-width="2"/>
    <polygon points="495,555 485,550 485,560" fill="#333"/>
    <text x="400" y="545" font-size="12" text-anchor="middle" fill="#333">10. POST /mcp tools/call</text>
    <text x="400" y="560" font-size="10" text-anchor="middle" fill="#666">Authorization: Bearer {token}</text>
  </g>
  
  <g id="step12">
    <rect x="470" y="585" width="80" height="40" fill="#FFF3CD" stroke="#FFC107" stroke-width="1.5" rx="3"/>
    <text x="510" y="602" font-size="11" font-weight="bold" text-anchor="middle" fill="#856404">Verify JWT</text>
    <text x="510" y="617" font-size="10" text-anchor="middle" fill="#856404">Check scopes</text>
  </g>
  
  <g id="step13">
    <line x1="510" y1="645" x2="885" y2="645" stroke="#666" stroke-width="2" stroke-dasharray="8,4"/>
    <polygon points="885,645 875,640 875,650" fill="#666"/>
    <text x="700" y="635" font-size="12" text-anchor="middle" fill="#666">11. Forward token (optional)</text>
  </g>
  
  <g id="step14">
    <line x1="885" y1="685" x2="525" y2="685" stroke="#F39C12" stroke-width="2" stroke-dasharray="8,4"/>
    <polygon points="525,685 535,680 535,690" fill="#F39C12"/>
    <text x="705" y="675" font-size="12" text-anchor="middle" fill="#F39C12">12. User-scoped data</text>
  </g>
  
  <g id="step15">
    <line x1="495" y1="725" x2="315" y2="725" stroke="#10A37F" stroke-width="2"/>
    <polygon points="315,725 325,720 325,730" fill="#10A37F"/>
    <text x="405" y="715" font-size="12" text-anchor="middle" fill="#10A37F">13. Tool result</text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="775" width="900" height="35" fill="#F8F9FA" stroke="#DEE2E6" stroke-width="1" rx="3"/>
    <text x="70" y="797" font-size="11" fill="#495057">
      <tspan font-weight="bold">Key:</tspan>
      <tspan x="125" dy="0">Solid lines = Required flow</tspan>
      <tspan x="320" dy="0">Dashed lines = Optional backend</tspan>
      <tspan x="540" dy="0">Yellow boxes = JWT verification</tspan>
    </text>
  </g>
</svg>